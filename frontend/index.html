<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Disease Spread Simulation</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }

        .lengend-stat.sp{
           font-size: 122px;
        } 
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            padding: 20px 0;
            margin-bottom: 30px;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .simulation-area {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
            position: relative;
        }
        
        .quarantine-area {
            position: absolute;
            bottom: 20px;
            right: 20px;
            width: 250px;
            height: 250px;
            border: 3px dashed #f39c12;
            border-radius: 10px;
            background: rgba(243, 156, 18, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
            color: #f39c12;
            pointer-events: none;
        }
        
        .controls {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
        }
        
        .control-group {
            margin-bottom: 20px;
        }
        
        h2 {
            font-size: 1.5rem;
            margin-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.3);
            padding-bottom: 8px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        input[type="range"] {
            width: 100%;
            margin-bottom: 10px;
        }
        
        .value-display {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        button {
            background: #4a90e2;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            width: 100%;
            margin-bottom: 10px;
        }
        
        button:hover {
            background: #3a7bc8;
            transform: translateY(-2px);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        button.reset {
            background: #e74c3c;
        }
        
        button.reset:hover {
            background: #c0392b;
        }
        
        button:disabled {
            background: #7f8c8d;
            cursor: not-allowed;
            transform: none;
        }
        
        #networkCanvas {
            width: 100%;
            height: 600px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            display: block;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .box{
            font-size: 34px;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            backdrop-filter: blur(5px);
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            margin: 10px 0;
        }
        
        .stat-label {
            font-size: 1.3rem;
            opacity: 0.9;
        }
        
        .healthy {
            color: #2ecc71;
        }
        
        .infected {
            color: #e74c3c;
        }
        
        .recovered {
            color: #3498db;
        }
        
        .quarantined {
            color: #f39c12;
        }
        
        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 125px;
            flex-wrap: wrap;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .legend-color {
            width: 25px;
            height: 25px;
            border-radius: 50%;
        }
        
        .healthy-color {
            background: #2ecc71;
        }
        
        .infected-color {
            background: #e74c3c;
        }
        
        .recovered-color {
            background: #3498db;
        }
        
        .quarantined-color {
            background: #f39c12;
        }
        
        .status {
            text-align: center;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.1);
        }
        
        .status.connected {
            background: rgba(46, 204, 113, 0.2);
            border: 1px solid #2ecc71;
        }
        
        .status.error {
            background: rgba(231, 76, 60, 0.2);
            border: 1px solid #e74c3c;
        }
        
        .chart-container {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            margin-top: 30px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
        }
        
        #realtimeChart {
            width: 100%;
            height: 300px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            padding: 10px;
        }
        
        footer {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            font-size: 0.9rem;
            opacity: 0.7;
        }
        
        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .stats {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .quarantine-area {
                width: 150px;
                height: 150px;
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Disease Spread Simulation with Quarantine</h1>
            <p class="subtitle">Watch infected nodes move to quarantine area and return after recovery</p>
        </header>
        
        <div id="statusMessage" class="status">Connecting to backend server...</div>
        
        <div class="dashboard">
            <div class="simulation-area">
                <canvas id="networkCanvas"></canvas>
                
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color healthy-color"></div>
                        <span class="box">Healthy</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color infected-color"></div>
                        <span class="box">Infected</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color recovered-color"></div>
                        <span class="box">Recovered</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color quarantined-color"></div>
                        <span class="box">Quarantined</span>
                    </div>
                </div>
            </div>
            
            <div class="controls">
                <div class="control-group">
                    <h2>Simulation Controls</h2>
                    <button id="startBtn">Start Simulation</button>
                    <button id="pauseBtn" disabled>Pause Simulation</button>
                    <button id="stepBtn" disabled>Step Forward</button>
                    <button id="resetBtn" class="reset" disabled>Reset Simulation</button>
                </div>
                
                <div class="control-group">
                    <h2>Disease Parameters</h2>
                    <label for="infectionRate">Infection Rate: <span id="infectionRateValue">0.3</span></label>
                    <input type="range" id="infectionRate" min="0.01" max="1" step="0.01" value="0.3">
                    
                    <label for="recoveryRate">Recovery Rate: <span id="recoveryRateValue">0.1</span></label>
                    <input type="range" id="recoveryRate" min="0.01" max="0.5" step="0.01" value="0.1">
                    
                    <label for="quarantineRate">Quarantine Rate: <span id="quarantineRateValue">0.3</span></label>
                    <input type="range" id="quarantineRate" min="0.01" max="0.8" step="0.01" value="0.3">
                    
                    <label for="deathRate">Death Rate: <span id="deathRateValue">0.02</span></label>
                    <input type="range" id="deathRate" min="0" max="0.2" step="0.01" value="0.02">
                    
                    <label for="initialInfected">Initial Infected: <span id="initialInfectedValue">5</span></label>
                    <input type="range" id="initialInfected" min="1" max="20" step="1" value="5">
                </div>
                
                <div class="control-group">
                    <h2>Simulation Info</h2>
                    <div class="value-display">
                        <span>Step:</span>
                        <span id="stepCount">0</span>
                    </div>
                    <div class="value-display">
                        <span>Speed:</span>
                        <span id="speedValue">Normal</span>
                    </div>
                    <div class="value-display">
                        <span>Backend:</span>
                        <span id="backendStatus">Checking...</span>
                    </div>
                </div>
                
                <div class="control-group">
                    <h2>Visualization</h2>
                    <label for="simulationSpeed">Simulation Speed: <span id="speedDisplay">200ms</span></label>
                    <input type="range" id="simulationSpeed" min="50" max="1000" step="50" value="200">
                    
                    <label for="edgeVisibility">Show Edges:</label>
                    <select id="edgeVisibility">
                        <option value="all">All Edges</option>
                        <option value="partial">Partial (50%)</option>
                        <option value="none">None</option>
                    </select>
                </div>
            </div>
        </div>
        
        <div class="stats">
            <div class="stat-card">
                <div class="stat-label">Total Nodes</div>
                <div class="stat-value" id="totalNodes">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Healthy</div>
                <div class="stat-value healthy" id="healthyCount">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Infected</div>
                <div class="stat-value infected" id="infectedCount">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Recovered</div>
                <div class="stat-value recovered" id="recoveredCount">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Quarantined</div>
                <div class="stat-value quarantined" id="quarantinedCount">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Deceased</div>
                <div class="stat-value" id="deceasedCount">0</div>
            </div>
        </div>
        
        <div class="chart-container">
            <h2>Disease Spread Over Time</h2>
            <div id="realtimeChart"></div>
        </div>
        
        <footer>
            <p>Disease Spread Simulation | Moving Quarantine System | Watch nodes move to quarantine area and return after recovery</p>
        </footer>
    </div>

    <script>
        const API_BASE = 'http://127.0.0.1:5000/api';
        
        let simulation = {
            running: false,
            nodes: [],
            edges: [],
            step: 0,
            backendConnected: false,
            simulationSpeed: 200,
            showEdges: 'all'
        };
        
        let realtimeChart = null;
        let canvas = null;
        let ctx = null;
        let simulationInterval = null;
        
        class RealtimeChart {
            constructor(containerId, maxDataPoints = 100) {
                this.container = document.getElementById(containerId);
                this.canvas = document.createElement('canvas');
                this.canvas.width = this.container.clientWidth;
                this.canvas.height = 300;
                this.container.appendChild(this.canvas);
                
                this.ctx = this.canvas.getContext('2d');
                this.maxDataPoints = maxDataPoints;
                
                this.data = {
                    healthy: [],
                    infected: [],
                    recovered: [],
                    quarantined: [],
                    deceased: [],
                    timestamps: []
                };
                
                this.colors = {
                    healthy: '#2ecc71',
                    infected: '#e74c3c',
                    recovered: '#3498db',
                    quarantined: '#f39c12',
                    deceased: '#7f8c8d'
                };
            }
            
            resize() {
                this.canvas.width = this.container.clientWidth;
                this.draw();
            }
            
            addDataPoint(stats, step) {
                this.data.healthy.push(stats.healthy);
                this.data.infected.push(stats.infected);
                this.data.recovered.push(stats.recovered);
                this.data.quarantined.push(stats.quarantined || 0);
                this.data.deceased.push(stats.deceased || 0);
                this.data.timestamps.push(step);
                
                if (this.data.healthy.length > this.maxDataPoints) {
                    this.data.healthy.shift();
                    this.data.infected.shift();
                    this.data.recovered.shift();
                    this.data.quarantined.shift();
                    this.data.deceased.shift();
                    this.data.timestamps.shift();
                }
                
                this.draw();
            }
            
            clear() {
                this.data = {
                    healthy: [],
                    infected: [],
                    recovered: [],
                    quarantined: [],
                    deceased: [],
                    timestamps: []
                };
                this.draw();
            }
            
            draw() {
                const ctx = this.ctx;
                const width = this.canvas.width;
                const height = this.canvas.height;
                const padding = 40;
                const chartWidth = width - padding * 2;
                const chartHeight = height - padding * 2;
                
                ctx.clearRect(0, 0, width, height);
                
                if (this.data.timestamps.length === 0) return;
                
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
                ctx.lineWidth = 1;
                
                const xStep = chartWidth / 10;
                for (let i = 0; i <= 10; i++) {
                    ctx.beginPath();
                    ctx.moveTo(padding + i * xStep, padding);
                    ctx.lineTo(padding + i * xStep, height - padding);
                    ctx.stroke();
                }
                
                const yStep = chartHeight / 5;
                for (let i = 0; i <= 5; i++) {
                    ctx.beginPath();
                    ctx.moveTo(padding, padding + i * yStep);
                    ctx.lineTo(width - padding, padding + i * yStep);
                    ctx.stroke();
                }
                
                const allData = [
                    ...this.data.healthy,
                    ...this.data.infected,
                    ...this.data.recovered,
                    ...this.data.quarantined,
                    ...this.data.deceased
                ];
                const maxValue = Math.max(...allData);
                
                const drawSeries = (data, color, label) => {
                    if (data.length === 0) return;
                    
                    ctx.strokeStyle = color;
                    ctx.fillStyle = color;
                    ctx.lineWidth = 2;
                    
                    ctx.beginPath();
                    for (let i = 0; i < data.length; i++) {
                        const x = padding + (i / (this.data.timestamps.length - 1)) * chartWidth;
                        const y = height - padding - (data[i] / maxValue) * chartHeight;
                        
                        if (i === 0) {
                            ctx.moveTo(x, y);
                        } else {
                            ctx.lineTo(x, y);
                        }
                    }
                    ctx.stroke();
                    
                    for (let i = 0; i < data.length; i++) {
                        const x = padding + (i / (this.data.timestamps.length - 1)) * chartWidth;
                        const y = height - padding - (data[i] / maxValue) * chartHeight;
                        
                        ctx.beginPath();
                        ctx.arc(x, y, 3, 0, Math.PI * 2);
                        ctx.fill();
                    }
                    
                    const legendX = width - 150;
                    const legendY = 20 + Object.keys(this.colors).indexOf(label) * 20;
                    
                    ctx.fillStyle = color;
                    ctx.fillRect(legendX, legendY, 15, 10);
                    
                    ctx.fillStyle = 'white';
                    ctx.font = '12px Arial';
                    ctx.fillText(label.charAt(0).toUpperCase() + label.slice(1), legendX + 20, legendY + 10);
                };
                
                drawSeries(this.data.healthy, this.colors.healthy, 'healthy');
                drawSeries(this.data.infected, this.colors.infected, 'infected');
                drawSeries(this.data.recovered, this.colors.recovered, 'recovered');
                drawSeries(this.data.quarantined, this.colors.quarantined, 'quarantined');
                drawSeries(this.data.deceased, this.colors.deceased, 'deceased');
                
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.5)';
                ctx.lineWidth = 2;
                
                ctx.beginPath();
                ctx.moveTo(padding, height - padding);
                    ctx.lineTo(width - padding, height - padding);
                ctx.stroke();
                
                ctx.beginPath();
                ctx.moveTo(padding, padding);
                ctx.lineTo(padding, height - padding);
                ctx.stroke();
                
                ctx.fillStyle = 'white';
                ctx.font = '12px Arial';
                ctx.textAlign = 'center';
                
                for (let i = 0; i < this.data.timestamps.length; i += Math.ceil(this.data.timestamps.length / 5)) {
                    const x = padding + (i / (this.data.timestamps.length - 1)) * chartWidth;
                    ctx.fillText(`Step ${this.data.timestamps[i]}`, x, height - padding + 20);
                }
                
                ctx.textAlign = 'right';
                for (let i = 0; i <= 5; i++) {
                    const y = padding + i * (chartHeight / 5);
                    const value = Math.round((maxValue * (5 - i)) / 5);
                    ctx.fillText(value.toString(), padding - 5, y + 4);
                }
                
                ctx.textAlign = 'center';
                ctx.font = '14px Arial';
                ctx.fillText('Disease Spread Over Time', width / 2, 20);
            }
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            canvas = document.getElementById('networkCanvas');
            ctx = canvas.getContext('2d');
            const statusMessage = document.getElementById('statusMessage');
            const backendStatus = document.getElementById('backendStatus');
            const startBtn = document.getElementById('startBtn');
            const pauseBtn = document.getElementById('pauseBtn');
            const stepBtn = document.getElementById('stepBtn');
            const resetBtn = document.getElementById('resetBtn');
            const stepCount = document.getElementById('stepCount');
            const speedValue = document.getElementById('speedValue');
            const speedDisplay = document.getElementById('speedDisplay');
            
            realtimeChart = new RealtimeChart('realtimeChart');
            
            function setCanvasSize() {
                canvas.width = canvas.offsetWidth;
                canvas.height = canvas.offsetHeight;
            }
            
            setCanvasSize();
            window.addEventListener('resize', () => {
                setCanvasSize();
                realtimeChart.resize();
                drawNetwork();
            });
            
            async function checkBackendConnection() {
                try {
                    const response = await fetch(`${API_BASE}/status`);
                    if (response.ok) {
                        simulation.backendConnected = true;
                        statusMessage.textContent = 'Connected to simulation backend';
                        statusMessage.className = 'status connected';
                        backendStatus.textContent = 'Connected';
                        return true;
                    }
                } catch (error) {
                    console.error('Backend connection failed:', error);
                }
                
                simulation.backendConnected = false;
                statusMessage.textContent = 'Backend server not available. Please start the Python server.';
                statusMessage.className = 'status error';
                backendStatus.textContent = 'Disconnected';
                return false;
            }
            
            async function loadNetwork() {
                if (!simulation.backendConnected) return;
                
                try {
                    const response = await fetch(`${API_BASE}/network`);
                    const data = await response.json();
                    
                    simulation.nodes = data.nodes;
                    simulation.edges = data.edges;
                    
                    document.getElementById('totalNodes').textContent = data.total_nodes;
                    updateStats();
                    drawNetwork();
                } catch (error) {
                    console.error('Failed to load network:', error);
                }
            }
            
            async function startSimulation() {
                if (!simulation.backendConnected) {
                    alert('Please start the backend server first');
                    return;
                }
                
                const infectionRate = parseFloat(document.getElementById('infectionRate').value);
                const recoveryRate = parseFloat(document.getElementById('recoveryRate').value);
                const quarantineRate = parseFloat(document.getElementById('quarantineRate').value);
                const deathRate = parseFloat(document.getElementById('deathRate').value);
                const initialInfected = parseInt(document.getElementById('initialInfected').value);
                
                try {
                    const response = await fetch(`${API_BASE}/simulation/start`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            infectionRate: infectionRate,
                            recoveryRate: recoveryRate,
                            quarantineRate: quarantineRate,
                            deathRate: deathRate,
                            initialInfected: initialInfected
                        })
                    });
                    
                    const data = await response.json();
                    
                    if (data.status === 'started') {
                        simulation.running = true;
                        simulation.step = data.step;
                        
                        // Update nodes with positions from backend
                        if (data.nodes) {
                            simulation.nodes = data.nodes;
                        }
                        
                        updateStats(data);
                        drawNetwork();
                        updateControls();
                        realtimeChart.clear();
                        realtimeChart.addDataPoint(data, data.step);
                        
                        // Start simulation loop
                        startSimulationLoop();
                    }
                } catch (error) {
                    console.error('Failed to start simulation:', error);
                    alert('Failed to start simulation. Please check backend server.');
                }
            }
            
            async function stepSimulation() {
                if (!simulation.running || !simulation.backendConnected) return;
                
                try {
                    const response = await fetch(`${API_BASE}/simulation/step`);
                    const data = await response.json();
                    
                    if (data.error) {
                        console.error('Simulation error:', data.error);
                        return;
                    }
                    
                    simulation.step = data.step;
                    
                    // Update nodes with positions from backend
                    if (data.nodes) {
                        simulation.nodes = data.nodes;
                    }
                    
                    updateStats(data);
                    drawNetwork();
                    stepCount.textContent = simulation.step;
                    
                    realtimeChart.addDataPoint(data, simulation.step);
                } catch (error) {
                    console.error('Simulation step failed:', error);
                }
            }
            
            function startSimulationLoop() {
                if (simulationInterval) {
                    clearInterval(simulationInterval);
                }
                
                simulationInterval = setInterval(async () => {
                    if (simulation.running) {
                        await stepSimulation();
                    } else {
                        clearInterval(simulationInterval);
                    }
                }, simulation.simulationSpeed);
            }
            
            async function stopSimulation() {
                simulation.running = false;
                
                if (simulationInterval) {
                    clearInterval(simulationInterval);
                }
                
                if (simulation.backendConnected) {
                    try {
                        await fetch(`${API_BASE}/simulation/stop`, { method: 'POST' });
                    } catch (error) {
                        console.error('Failed to stop simulation:', error);
                    }
                }
                
                updateControls();
            }
            
            async function resetSimulation() {
                simulation.running = false;
                
                if (simulationInterval) {
                    clearInterval(simulationInterval);
                }
                
                if (simulation.backendConnected) {
                    try {
                        await fetch(`${API_BASE}/simulation/reset`, { method: 'POST' });
                        await loadNetwork();
                        simulation.step = 0;
                        stepCount.textContent = '0';
                    } catch (error) {
                        console.error('Failed to reset simulation:', error);
                    }
                }
                
                if (realtimeChart) {
                    realtimeChart.clear();
                }
                updateControls();
            }
            
            function updateStats(data = null) {
                if (data) {
                    document.getElementById('healthyCount').textContent = data.healthy;
                    document.getElementById('infectedCount').textContent = data.infected;
                    document.getElementById('recoveredCount').textContent = data.recovered;
                    document.getElementById('quarantinedCount').textContent = data.quarantined || 0;
                    document.getElementById('deceasedCount').textContent = data.deceased || 0;
                } else {
                    const healthyCount = simulation.nodes.filter(node => node.state === 'healthy').length;
                    const infectedCount = simulation.nodes.filter(node => node.state === 'infected').length;
                    const recoveredCount = simulation.nodes.filter(node => node.state === 'recovered').length;
                    const quarantinedCount = simulation.nodes.filter(node => node.state === 'quarantined').length;
                    const deceasedCount = simulation.nodes.filter(node => node.state === 'deceased').length;
                    
                    document.getElementById('healthyCount').textContent = healthyCount;
                    document.getElementById('infectedCount').textContent = infectedCount;
                    document.getElementById('recoveredCount').textContent = recoveredCount;
                    document.getElementById('quarantinedCount').textContent = quarantinedCount;
                    document.getElementById('deceasedCount').textContent = deceasedCount;
                }
            }
            
            function drawNetwork() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // Draw quarantine area background
                ctx.fillStyle = 'rgba(243, 156, 18, 0.05)';
                const quarantineX = canvas.width * 0.6;
                const quarantineY = canvas.height * 0.5;
                const quarantineWidth = canvas.width * 0.45;
                const quarantineHeight = canvas.height * 0.5;
                ctx.fillRect(quarantineX, quarantineY, quarantineWidth, quarantineHeight);
                // Draw quarantine border
                ctx.strokeStyle = '#f39c12';
                ctx.lineWidth = 2;
                ctx.setLineDash([5, 5]);
                ctx.strokeRect(quarantineX, quarantineY, quarantineWidth, quarantineHeight);
                ctx.setLineDash([]);

                // Draw "Quarantine Zone" label centered in the quarantine area
                ctx.fillStyle = '#f39c12';
                ctx.font = `${Math.max(12, Math.floor(quarantineWidth * 0.06))}px Arial`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText('Quarantine Zone', quarantineX + quarantineWidth / 2, quarantineY + quarantineHeight / 2);

                // Draw edges (with visibility control)
                if (simulation.showEdges !== 'none') {
                    ctx.strokeStyle = 'rgba(255, 255, 255, 0.15)';
                    ctx.lineWidth = 0.5;
                    
                    for (const edge of simulation.edges) {
                        if (simulation.showEdges === 'partial' && Math.random() > 0.5) {
                            continue;
                        }
                        
                        const source = simulation.nodes[edge.source];
                        const target = simulation.nodes[edge.target];
                        
                        if (source && target) {
                            ctx.beginPath();
                            ctx.moveTo(source.x * canvas.width, source.y * canvas.height);
                            ctx.lineTo(target.x * canvas.width, target.y * canvas.height);
                            ctx.stroke();
                        }
                    }
                }
                
                // Draw nodes
                for (const node of simulation.nodes) {
                    if (!node) continue;
                    
                    const x = node.x * canvas.width;
                    const y = node.y * canvas.height;
                    let radius = 6;
                    let color;
                    
                    switch (node.state) {
                        case 'healthy': 
                            color = '#2ecc71';
                            radius = 3;
                            break;
                        case 'infected': 
                            color = '#e74c3c';
                            radius = 4;
                            break;
                        case 'recovered': 
                            color = '#3498db';
                            radius = 3;
                            break;
                        case 'quarantined': 
                            color = '#f39c12';
                            radius = 3;
                            break;
                                case 'deceased':
                                    color = '#7f8c8d';
                                    radius = 3;
                                    break;
                        default: 
                            color = '#2ecc71';
                            radius = 3;
                    }
                    
                    // Draw node
                    ctx.fillStyle = color;
                    ctx.beginPath();
                    ctx.arc(x, y, radius, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // Add glow effect for infected nodes
                    if (node.state === 'infected') {
                        ctx.shadowColor = '#e74c3c';
                        ctx.shadowBlur = 15;
                        ctx.beginPath();
                        ctx.arc(x, y, radius + 2, 0, Math.PI * 2);
                        ctx.fill();
                        ctx.shadowBlur = 0;
                    }
                    
                    // Add border for quarantined nodes
                    if (node.state === 'quarantined') {
                        ctx.strokeStyle = '#f39c12';
                        ctx.lineWidth = 2;
                        ctx.beginPath();
                        ctx.arc(x, y, radius + 1, 0, Math.PI * 2);
                        ctx.stroke();
                    }
                }
            }
            
            function updateControls() {
                startBtn.disabled = simulation.running;
                pauseBtn.disabled = !simulation.running;
                stepBtn.disabled = simulation.running;
                resetBtn.disabled = simulation.running;
            }
            
            // Event listeners for controls
            document.getElementById('infectionRate').addEventListener('input', function() {
                document.getElementById('infectionRateValue').textContent = this.value;
            });
            
            document.getElementById('recoveryRate').addEventListener('input', function() {
                document.getElementById('recoveryRateValue').textContent = this.value;
            });
            
            document.getElementById('quarantineRate').addEventListener('input', function() {
                document.getElementById('quarantineRateValue').textContent = this.value;
            });
            
            document.getElementById('initialInfected').addEventListener('input', function() {
                document.getElementById('initialInfectedValue').textContent = this.value;
            });

            document.getElementById('deathRate').addEventListener('input', function() {
                document.getElementById('deathRateValue').textContent = this.value;
            });
            
            document.getElementById('simulationSpeed').addEventListener('input', function() {
                simulation.simulationSpeed = parseInt(this.value);
                speedDisplay.textContent = `${this.value}ms`;
                
                if (simulation.simulationSpeed < 300) {
                    speedValue.textContent = 'Fast';
                } else if (simulation.simulationSpeed < 700) {
                    speedValue.textContent = 'Normal';
                } else {
                    speedValue.textContent = 'Slow';
                }
                
                // Restart interval with new speed if simulation is running
                if (simulation.running) {
                    startSimulationLoop();
                }
            });
            
            document.getElementById('edgeVisibility').addEventListener('change', function() {
                simulation.showEdges = this.value;
                drawNetwork();
            });
            
            startBtn.addEventListener('click', startSimulation);
            pauseBtn.addEventListener('click', stopSimulation);
            stepBtn.addEventListener('click', stepSimulation);
            resetBtn.addEventListener('click', resetSimulation);
            
            async function initialize() {
                await checkBackendConnection();
                await loadNetwork();
                updateControls();
            }
            
            initialize();
        });
    </script>
</body>
</html>